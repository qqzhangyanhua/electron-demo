"use strict";const n=require("electron"),f=require("path"),d=require("fs"),{exec:h}=require("child_process"),w=require("node-schedule"),v=()=>{const e=new n.BrowserWindow({width:900,height:600,minHeight:600,minWidth:900,icon:f.resolve(__dirname,"../favicon.ico"),webPreferences:{nodeIntegration:!0,contextIsolation:!1,webSecurity:!1},autoHideMenuBar:!0});process.env.VITE_DEV_SERVER_URL?e.loadURL(process.env.VITE_DEV_SERVER_URL):e.loadFile(f.resolve(__dirname,"../dist/index.html"))};n.app.whenReady().then(()=>{v()});n.app.on("window-all-closed",()=>{process.platform!="darwin"&&n.app.quit()});n.app.on("activate",()=>{n.BrowserWindow.getAllWindows.length==0&&v()});n.ipcMain.on("open-folder",(e,o)=>{n.dialog.showOpenDialog({properties:["openDirectory"]}).then(t=>{if(t.canceled)return;const r=d.readdirSync(t.filePaths[0]),i=t.filePaths[0];console.log("路径前缀===",i);const s=[];for(const c of r){const u=f.join(i,c);d.statSync(u).isDirectory()&&s.push({filePath:u,fileName:c})}console.log("directoryList",s),d.writeFile("data.json",JSON.stringify(s),c=>{if(c){console.error(c);return}console.log("Data written to file")}),e.sender.send("directoryList",s)})});n.ipcMain.on("scriptExe",(e,o)=>{console.log("scriptExe==================",o),o.type==="vscode"&&h(`cd ${o.filePath} && code .`,(t,r,i)=>{if(t){console.error(`exec error: ${t}`);return}console.log(`stdout: ${r}`),console.error(`stderr: ${i}`)}),o.type==="iterm"&&h(`cd ${o.filePath} && open -a iTerm .`,(t,r,i)=>{if(t){console.error(`exec error: ${t}`);return}console.log(`stdout: ${r}`),console.error(`stderr: ${i}`)})});let l;n.ipcMain.on("setAlarm",(e,o)=>{console.log("setAlarm==================",o),console.log("job===",l),l&&l.cancel(),l=w.scheduleJob(new Date(o.time),function(){e.sender.send("alarmTriggered");var t=new n.Notification({title:o.title,body:o.body});t.show()})});n.ipcMain.on("reminderEvent",(e,o)=>{p(o)});n.ipcMain.on("reminderEvent2",(e,o)=>{p(o)});n.ipcMain.on("reminderEvent1",(e,o)=>{p(o)});const a={reminderEvent:null,reminderEvent1:null,reminderEvent2:null};function p(e){if(console.log("setAlarm==================",e),e.action==="cancel"){a[e.eventKey].cancel();return}a[e.eventKey]&&a[e.eventKey].cancel(),a[e.eventKey]=w.scheduleJob(new Date(e.time),function(){var o=new n.Notification({title:e.title,body:e.body});o.show()})}
